from solana.publickey import PublicKey
from solana.rpc.api import Client
from solana.transaction import Transaction
from solders.keypair import Keypair  # pip install solders
import requests
import base64

# Setup (replace with your values)
rpc_url = "https://api.mainnet-beta.solana.com"
client = Client(rpc_url)
wallet = Keypair.from_secret_key(bytes.fromhex('YOUR_PRIVATE_KEY_HEX'))  # Dangerous; use securely

def get_jupiter_quote(input_mint, output_mint, amount):
    url = f"https://quote-api.jup.ag/v6/quote?inputMint={input_mint}&outputMint={output_mint}&amount={amount}&slippageBps=50"
    response = requests.get(url)
    return response.json()

def execute_swap(quote):
    url = "https://quote-api.jup.ag/v6/swap"
    payload = {
        "quoteResponse": quote,
        "userPublicKey": str(wallet.pubkey()),
        "wrapAndUnwrapSol": True
    }
    response = requests.post(url, json=payload)
    swap_tx = response.json()['swapTransaction']
    raw_tx = base64.b64decode(swap_tx)
    tx = Transaction.deserialize(raw_tx)
    tx.sign(wallet)
    tx_sig = client.send_transaction(tx)
    print(f"Swap TX: {tx_sig}")

# Example: Swap 0.1 SOL to USDC
sol_mint = "So11111111111111111111111111111111111111112"
usdc_mint = "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
amount = 100000000  # 0.1 SOL (9 decimals)
quote = get_jupiter_quote(sol_mint, usdc_mint, amount)
execute_swap(quote)
